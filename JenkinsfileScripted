node {
    try {
        stage('checkout') {
            // Uncomment the following block to enable checkout stage
            /* 
            echo 'Checking out !!'
            git 'https://github.com/rohitkhandagale19/TestAutomationFramework.git'
            */
        }
        
        stage('compile') {
            echo 'Compiling'
            bat 'mvn compile'
        }
        
        stage('test') {
            echo 'Testing'
            bat 'mvn test'
        }
        
        stage('package') {
            // Uncomment the following block to enable package stage
            /*
            echo 'Building'
            bat 'mvn clean package'
            */
        }
    } catch (Exception e) {
        currentBuild.result = 'FAILURE'
        throw e
    } finally {
        if (currentBuild.result == 'SUCCESS') {
            echo 'Pipeline succeeded! Archiving artifacts...'
            archiveArtifacts artifacts: 'target/surefire-reports/emailable-report.html', followSymlinks: false
            archiveArtifacts artifacts: '**/target/surefire-reports/*.xml', followSymlinks: false
            
            // Publish HTML report
            publishHTML(target: [
                allowMissing: false,
                alwaysLinkToLastBuild: true,
                keepAll: true,
                reportDir: 'target/surefire-reports',
                reportFiles: 'emailable-report.html',
                reportName: 'Test Automation Report'
            ])
        }
        
        echo 'Pipeline finished!'
    }
}
